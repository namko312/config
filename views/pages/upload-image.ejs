<% layout('/layouts/layout_feature.ejs') %>
<div id="app">
  <div>
    <input type="file" v-on:change="onImageChange" class="form-control d-inline-block" style="width: 200px">
    <input type="text" v-model="filename"  class="form-control d-inline-block" style="width: 200px" placeholder="TÃªn file">
    <button v-if="file && filename" class="btn btn-primary" @click="upload()">Upload</button>
  </div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.18.0/axios.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script>
  var app = new Vue({
    el: '#app',
    data: {
      file: null,
      filename: ''
    },
    created: function() {
      this.getData()
    },
    methods: {
      getData: async function () {
        try {
          let res = await axios.get('/upload-image/get')
          console.log(res)
        } catch (e) {
          alert(e.toString())
        }
      },
      onImageChange: function (e) {
        let files = e.target.files || e.dataTransfer.files
        if (!files.length) return this.file = null
        this.file = files[0]
      },
      upload: async function () {
        try {
          let ext = this.file.name.split('.').pop()
          const formData = new FormData()
          formData.append('filename', this.filename + '.' + ext)
          formData.append('file', this.file)
          let resUpload = await axios.post('/upload-image/upload', formData, {
            headers: {
              'Content-Type': 'multipart/form-data'
            }
          })
        } catch (e) {
          alert(e.toString())
        }
      }
    },
  })
</script>
<style>
  .create-tygia-wrapper {
    border: 1px solid #ccc;
    padding: 20px;
    margin: 15px 0 15px 0;
  }
</style>
